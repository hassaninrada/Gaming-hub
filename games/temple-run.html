<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temple Run 2: Jungle Supreme</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@900&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #0a0705;
            font-family: 'Outfit', sans-serif;
        }

        #ui {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 100;
            color: white;
        }

        .hud {
            padding: 40px;
            display: flex;
            justify-content: space-between;
        }

        .score-val {
            font-size: 48px;
            font-weight: 900;
            color: #fbbf24;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        #menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: auto;
            background: rgba(0, 0, 0, 0.8);
            padding: 60px;
            border-radius: 40px;
            border: 2px solid #fbbf24;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 60px;
            margin: 0;
            color: #fbbf24;
            text-transform: uppercase;
        }

        button {
            background: #fbbf24;
            color: #000;
            border: none;
            padding: 20px 60px;
            font-size: 24px;
            font-weight: 900;
            border-radius: 15px;
            cursor: pointer;
            margin-top: 30px;
        }
    </style>
</head>

<body>
    <div id="ui">
        <div class="hud">
            <div><small style="opacity:0.5; letter-spacing:2px;">DISTANCE</small><br><span class="score-val"
                    id="score">0</span>m</div>
            <div style="text-align:right;"><small style="opacity:0.5; letter-spacing:2px;">COINS</small><br><span
                    class="score-val" id="coins">0</span></div>
        </div>
        <div id="menu">
            <h1>TEMPLE RUN 2</h1>
            <p style="opacity: 0.7;">SUPREME JUNGLE ESCAPE</p>
            <button onclick="startGame()">RUN FOR LIFE</button>
            <p style="margin-top:20px; font-size:12px; opacity:0.4;">A / D to Switch Lanes â€¢ SPACE to Jump</p>
        </div>
    </div>

    <script>
        let scene, camera, renderer, player, monster, clock;
        let segments = [], obstacles = [], coins = [], powerUps = [];
        let gameActive = false, score = 0, coinCount = 0, speed = 2.5, lane = 0, targetLane = 0;
        let magnetActive = false, magnetTimer = 0, shieldActive = false, shieldTimer = 0;
        let combo = 0, comboTimer = 0, isSliding = false;
        const LANE_WIDTH = 3.5;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0705);
            scene.fog = new THREE.Fog(0x0a0705, 40, 250);

            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 8, 15);
            camera.lookAt(0, 2, -10);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Warm Jungle Lighting
            scene.add(new THREE.AmbientLight(0xffffff, 0.4));
            const sun = new THREE.DirectionalLight(0xffcc88, 1.2);
            sun.position.set(20, 50, 10); sun.castShadow = true;
            scene.add(sun);

            createPlayer();
            createMonster();
            for (let i = 0; i < 15; i++) spawnSegment(i * -20);

            window.addEventListener('keydown', handleKey);
            animate();
        }

        function createPlayer() {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.8, 1.8, 0.5), new THREE.MeshPhongMaterial({ color: 0x8b4513 }));
            body.position.y = 1.2; body.castShadow = true;
            group.add(body);
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.35), new THREE.MeshPhongMaterial({ color: 0xffdbac }));
            head.position.y = 2.3; group.add(head);
            player = group;
            scene.add(player);
        }

        function createMonster() {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(4, 5, 3), new THREE.MeshPhongMaterial({ color: 0x332211 }));
            body.position.y = 2.5; body.castShadow = true;
            group.add(body);
            const head = new THREE.Mesh(new THREE.BoxGeometry(2, 2, 2), new THREE.MeshPhongMaterial({ color: 0x221100 }));
            head.position.y = 5.5; group.add(head);
            const eye1 = new THREE.Mesh(new THREE.SphereGeometry(0.3), new THREE.MeshBasicMaterial({ color: 0xff0000 }));
            eye1.position.set(0.5, 6, 1); group.add(eye1);
            const eye2 = eye1.clone(); eye2.position.x = -0.5; group.add(eye2);
            monster = group;
            monster.position.z = 10;
            scene.add(monster);
        }

        function spawnSegment(z) {
            const group = new THREE.Group();
            // Ancient Bridge
            const bridge = new THREE.Mesh(new THREE.BoxGeometry(12, 1, 20), new THREE.MeshPhongMaterial({ color: 0x4a4a3a }));
            bridge.receiveShadow = true;
            group.add(bridge);

            // Side Rails (Stone arches)
            for (let i = -1; i <= 1; i += 2) {
                const rail = new THREE.Mesh(new THREE.BoxGeometry(1, 4, 20), new THREE.MeshPhongMaterial({ color: 0x3a3a2a }));
                rail.position.set(i * 6.5, 2, 0);
                group.add(rail);
            }

            group.position.z = z;
            scene.add(group);
            segments.push(group);

            // Obstacles
            if (Math.random() > 0.6) {
                const obs = new THREE.Mesh(new THREE.BoxGeometry(LANE_WIDTH, 2, 1), new THREE.MeshPhongMaterial({ color: 0x221100 }));
                obs.position.set((Math.floor(Math.random() * 3) - 1) * LANE_WIDTH, 1.5, z);
                scene.add(obs);
                obstacles.push(obs);
            }
            // Coins
            if (Math.random() > 0.3) {
                const coinCountInSegment = Math.floor(Math.random() * 3) + 1;
                for (let i = 0; i < coinCountInSegment; i++) {
                    const coin = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 0.1, 16), new THREE.MeshPhongMaterial({ color: 0xfbbf24 }));
                    coin.rotation.x = Math.PI / 2;
                    coin.position.set((Math.floor(Math.random() * 3) - 1) * LANE_WIDTH, 1.5, z - 5 + i * 5);
                    scene.add(coin);
                    coins.push(coin);
                }
            }
        }

        function handleKey(e) {
            if (!gameActive) return;
            if (e.code === 'KeyA' && targetLane > -1) targetLane--;
            if (e.code === 'KeyD' && targetLane < 1) targetLane++;
            if ((e.code === 'Space' || e.code === 'ArrowUp') && player.position.y < 0.2 && !isSliding) {
                new TWEEN.Tween(player.position).to({ y: 6 }, 250).easing(TWEEN.Easing.Quadratic.Out)
                    .onComplete(() => new TWEEN.Tween(player.position).to({ y: 0 }, 350).easing(TWEEN.Easing.Quadratic.In).start()).start();
            }
            if (e.code === 'ArrowDown' && !isSliding && player.position.y < 0.2) {
                isSliding = true;
                new TWEEN.Tween(player.scale).to({ y: 0.5 }, 200).start();
                setTimeout(() => {
                    isSliding = false;
                    new TWEEN.Tween(player.scale).to({ y: 1 }, 200).start();
                }, 800);
            }
        }

        function startGame() {
            document.getElementById('menu').style.display = 'none';
            gameActive = true;
            clock = new THREE.Clock();
        }

        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time);
            if (gameActive) {
                speed += 0.0006;
                score += Math.floor(speed * 2);
                document.getElementById('score').innerText = Math.floor(score / 10);

                // Magnet logic
                if (magnetActive) {
                    magnetTimer--;
                    if (magnetTimer <= 0) magnetActive = false;
                }

                // Player Movement (Smoother)
                player.position.x += (targetLane * LANE_WIDTH - player.position.x) * 0.15;
                player.rotation.z = (player.position.x - targetLane * LANE_WIDTH) * 0.25;
                player.rotation.y = Math.PI + (player.position.x - targetLane * LANE_WIDTH) * 0.1;

                // Environment movement
                segments.forEach(s => {
                    s.position.z += speed;
                    if (s.position.z > 40) {
                        s.position.z -= segments.length * 20;
                    }
                });

                // Coins with Magnet effect
                coins.forEach((c, idx) => {
                    c.position.z += speed;
                    if (magnetActive && c.position.distanceTo(player.position) < 15) {
                        c.position.lerp(player.position, 0.2);
                    }
                    if (c.position.distanceTo(player.position) < 1.5) {
                        scene.remove(c); coins.splice(idx, 1);
                        coinCount++; document.getElementById('coins').innerText = coinCount;
                        if (Math.random() > 0.95) { magnetActive = true; magnetTimer = 500; }
                    }
                    if (c.position.z > 20) { scene.remove(c); coins.splice(idx, 1); }
                });

                obstacles.forEach((o, i) => {
                    o.position.z += speed;
                    if (o.position.z > 20) {
                        scene.remove(o); obstacles.splice(i, 1);
                    }
                    // Collision
                    if (Math.abs(o.position.z - player.position.z) < 1.2 && Math.abs(o.position.x - player.position.x) < 1.8 && player.position.y < 2) {
                        gameOver();
                    }
                });

                // Monster Chase Animation
                monster.position.z = 10 + Math.sin(time * 0.005) * 2;
                monster.position.x = player.position.x * 0.5;
                monster.position.y = Math.abs(Math.cos(time * 0.01)) * 1; // Stomping

                camera.fov = 70 + (speed * 5);
                camera.updateProjectionMatrix();
            }
            renderer.render(scene, camera);
        }

        function gameOver() {
            gameActive = false;
            document.getElementById('menu').style.display = 'block';
            document.querySelector('h1').innerText = "CAUGHT!";
        }

        init();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>

</html>