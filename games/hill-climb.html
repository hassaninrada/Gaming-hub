<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hill Climb Racing 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@900&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #87ceeb;
            font-family: 'Outfit', sans-serif;
        }

        #ui {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 100;
            color: white;
        }

        .hud {
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .stat {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 30px;
            border-radius: 15px;
            border-left: 5px solid #ef4444;
            width: fit-content;
        }

        .val {
            font-size: 32px;
            font-weight: 900;
            color: #ef4444;
        }

        #menu,
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 50px;
            border-radius: 30px;
            text-align: center;
            color: #ef4444;
            border: 2px solid #ef4444;
            pointer-events: auto;
            backdrop-filter: blur(10px);
        }

        button {
            background: #ef4444;
            color: #fff;
            border: none;
            padding: 20px 60px;
            font-size: 24px;
            font-weight: 900;
            border-radius: 15px;
            cursor: pointer;
            margin-top: 30px;
        }
    </style>
</head>

<body>
    <div id="ui">
        <div class="hud">
            <div class="stat">DISTANCE<br><span id="dist" class="val">0</span>m</div>
            <div class="stat">FUEL<br>
                <div
                    style="width:200px; height:10px; background:#333; border-radius:5px; margin-top:5px; overflow:hidden;">
                    <div id="fuel-fill" style="width:100%; height:100%; background:#ef4444;"></div>
                </div>
            </div>
        </div>
        <div id="menu">
            <h1>HILL CLIMB 3D</h1>
            <p style="color:#fff; opacity:0.7;">ULTRA JEEP SUPREME</p>
            <button onclick="startGame()">START RACE</button>
            <p style="margin-top:20px; color:#fff; opacity:0.3; font-size:12px;">ARROWS to Gas/Brake â€¢ AD to Balance</p>
        </div>
        <div id="game-over" style="display: none;">
            <h1 id="fail-msg">OUT OF FUEL!</h1>
            <p style="color:#fff;">Distance: <span id="final-dist">0</span>m</p>
            <button onclick="location.reload()">RETRY</button>
        </div>
    </div>

    <script>
        let scene, camera, renderer, car, terrainMesh, wheels = [], springs = [], fuelCans = [];
        let terrainPoints = [], gameActive = false, fuel = 100, dist = 0, checkpoints = [];
        let carVel = new THREE.Vector3(), particles = [], nitro = 100, usingNitro = false;

        function animate(time) {
            requestAnimationFrame(animate);
            if (gameActive) {
                let gas = 0;
                if (keys['ArrowRight']) {
                    gas = usingNitro ? 0.18 : 0.12;
                    fuel -= usingNitro ? 0.18 : 0.12;
                    if (usingNitro) nitro -= 0.5;

                    const p = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({ color: usingNitro ? 0xff6600 : 0xaaaaaa, transparent: true }));
                    p.position.copy(car.position).add(new THREE.Vector3(-2, 1, 0));
                    scene.add(p); particles.push({ mesh: p, life: 1, v: new THREE.Vector3(-0.1, 0.05, (Math.random() - 0.5) * 0.1) });
                }
                if (keys['ArrowLeft']) gas = -0.06;

                // Nitro boost
                usingNitro = keys['ShiftLeft'] && nitro > 0 && keys['ArrowRight'];

                carVel.x += gas; carVel.x *= 0.98;
                car.position.x += carVel.x;

                const idx = Math.floor(car.position.x);
                const h1 = terrainPoints[idx] || 0;
                const h2 = terrainPoints[idx + 1] || h1;
                const ratio = (car.position.x % 1 + 1) % 1;
                const groundY = h1 + (h2 - h1) * ratio + 1.5;

                if (car.position.y > groundY + 0.1) {
                    carVel.y -= 0.04;
                } else {
                    carVel.y = (groundY - car.position.y) * 0.4;
                    const angle = Math.atan2(h2 - h1, 1);
                    car.rotation.z += (angle - car.rotation.z) * 0.1;

                    // Enhanced spring animation
                    const compression = Math.abs(carVel.y) * 0.5;
                    springs.forEach(s => s.scale.y = Math.max(0.5, 1 - compression + Math.sin(time * 0.1) * 0.1));
                }
                car.position.y += carVel.y;

                if (Math.abs(car.position.y - groundY) > 1) {
                    if (keys['KeyA']) car.rotation.z += 0.08;
                    if (keys['KeyD']) car.rotation.z -= 0.08;
                }

                dist = Math.floor(car.position.x);
                document.getElementById('dist').innerText = dist;
                document.getElementById('fuel-fill').style.width = Math.max(0, fuel) + '%';

                // Speed display
                const speed = Math.abs(carVel.x * 10);
                document.getElementById('speed').innerText = Math.floor(speed);

                if (fuel <= 0 || Math.abs(car.rotation.z) > Math.PI * 0.75) {
                    gameActive = false; document.getElementById('game-over').style.display = 'block';
                    document.getElementById('fail-msg').innerText = fuel <= 0 ? "OUT OF FUEL!" : "FLIPPED!";
                    document.getElementById('final-dist').innerText = dist;
                }

                particles.forEach((p, idx) => {
                    p.mesh.position.add(p.v); p.life -= 0.02; p.mesh.material.opacity = p.life;
                    if (p.life <= 0) { scene.remove(p.mesh); particles.splice(idx, 1); }
                });

                fuelCans.forEach((c, idx) => {
                    if (c.position.distanceTo(car.position) < 2.5) {
                        fuel = Math.min(100, fuel + 30);
                        scene.remove(c); fuelCans.splice(idx, 1);
                    }
                });

                // Checkpoint system
                checkpoints.forEach((cp, idx) => {
                    if (Math.abs(cp.position.x - car.position.x) < 3 && !cp.collected) {
                        cp.collected = true;
                        nitro = Math.min(100, nitro + 50);
                        cp.material.color.set(0x00ff00);
                    }
                });

                camera.position.x = car.position.x + 15;
                camera.position.y = car.position.y + 8;
                camera.lookAt(car.position);
            }
            renderer.render(scene, camera);
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87ceeb);
            scene.fog = new THREE.Fog(0x87ceeb, 50, 200);

            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(10, 10, 25);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0xffffff, 0.6));
            const sun = new THREE.DirectionalLight(0xffffff, 1);
            sun.position.set(20, 50, 20); sun.castShadow = true;
            scene.add(sun);

            createTerrain();
            createJeep();
            createDecor();

            window.addEventListener('keydown', (e) => keys[e.code] = true);
            window.addEventListener('keyup', (e) => keys[e.code] = false);
            animate();
        }

        function createTerrain() {
            const count = 500;
            const geo = new THREE.PlaneGeometry(2000, 40, count, 1);
            geo.rotateX(-Math.PI / 2);
            const pos = geo.attributes.position.array;
            for (let i = 0; i <= count; i++) {
                const h = Math.sin(i * 0.08) * 5 + Math.cos(i * 0.04) * 8 + i * 0.05;
                terrainPoints.push(h);
                pos[i * 3 * 2 + 1] = h;
                pos[i * 3 * 2 + 3 + 1] = h;
                if (i > 20 && i % 30 === 0 && Math.random() > 0.5) spawnFuel(i, h);
            }
            geo.computeVertexNormals();
            terrainMesh = new THREE.Mesh(geo, new THREE.MeshPhongMaterial({ color: 0x4d7c0f, flatShading: true }));
            terrainMesh.position.x = 1000;
            scene.add(terrainMesh);
        }

        function createJeep() {
            car = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(4.5, 1.8, 2.2), new THREE.MeshPhongMaterial({ color: 0xef4444 }));
            body.position.y = 1.2; body.castShadow = true;
            car.add(body);
            const cabin = new THREE.Mesh(new THREE.BoxGeometry(2.5, 1.5, 2.1), new THREE.MeshPhongMaterial({ color: 0x222222 }));
            cabin.position.set(-0.5, 2.5, 0); car.add(cabin);

            const exhaust = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 0.5), new THREE.MeshPhongMaterial({ color: 0x333333 }));
            exhaust.position.set(-2.2, 0.8, 0); exhaust.rotation.z = Math.PI / 2;
            car.add(exhaust);

            const wheelOffsets = [[1.8, 0.8, 1.3], [1.8, 0.8, -1.3], [-1.8, 0.8, 1.3], [-1.8, 0.8, -1.3]];
            wheelOffsets.forEach(o => {
                const spring = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.2, 1.5, 8), new THREE.MeshPhongMaterial({ color: 0xfacc15 }));
                spring.position.set(o[0], 1.5, o[2]);
                car.add(spring);
                springs.push(spring);

                const w = new THREE.Mesh(new THREE.CylinderGeometry(1.0, 1.0, 0.6, 16), new THREE.MeshPhongMaterial({ color: 0x111111 }));
                w.rotation.x = Math.PI / 2;
                w.position.set(o[0], 0.6, o[2]);
                car.add(w);
                wheels.push(w);
            });

            car.position.set(5, 10, 0);
            scene.add(car);
        }

        function createDecor() {
            for (let i = 0; i < 100; i++) {
                const x = Math.random() * 1000;
                const tree = new THREE.Group();
                const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 2), new THREE.MeshPhongMaterial({ color: 0x3d2b1f }));
                const foliage = new THREE.Mesh(new THREE.ConeGeometry(1.5, 4, 8), new THREE.MeshPhongMaterial({ color: 0x064e3b }));
                foliage.position.y = 2.5;
                tree.add(trunk); tree.add(foliage);

                const idx = Math.floor(x);
                tree.position.set(x, terrainPoints[idx] || 0, -5 - Math.random() * 15);
                scene.add(tree);
            }
        }

        function spawnFuel(x, y) {
            const can = new THREE.Mesh(new THREE.BoxGeometry(0.8, 1.2, 0.8), new THREE.MeshPhongMaterial({ color: 0xff0000 }));
            can.position.set(x, y + 1.5, 0);
            scene.add(can);
            fuelCans.push(can);
        }

        let keys = {};
        function startGame() { document.getElementById('menu').style.display = 'none'; gameActive = true; }

        function animate(time) {
            requestAnimationFrame(animate);
            if (gameActive) {
                let gas = 0;
                if (keys['ArrowRight']) {
                    gas = 0.12; fuel -= 0.12;
                    const p = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({ color: 0xaaaaaa, transparent: true }));
                    p.position.copy(car.position).add(new THREE.Vector3(-2, 1, 0));
                    scene.add(p); particles.push({ mesh: p, life: 1, v: new THREE.Vector3(-0.1, 0.05, (Math.random() - 0.5) * 0.1) });
                }
                if (keys['ArrowLeft']) gas = -0.06;

                carVel.x += gas; carVel.x *= 0.98;
                car.position.x += carVel.x;

                const idx = Math.floor(car.position.x);
                const h1 = terrainPoints[idx] || 0;
                const h2 = terrainPoints[idx + 1] || h1;
                const ratio = (car.position.x % 1 + 1) % 1;
                const groundY = h1 + (h2 - h1) * ratio + 1.5;

                if (car.position.y > groundY + 0.1) {
                    carVel.y -= 0.04;
                } else {
                    carVel.y = (groundY - car.position.y) * 0.4;
                    const angle = Math.atan2(h2 - h1, 1);
                    car.rotation.z += (angle - car.rotation.z) * 0.1;
                    springs.forEach(s => s.scale.y = 1 + Math.sin(time * 0.1) * 0.2);
                }
                car.position.y += carVel.y;

                if (Math.abs(car.position.y - groundY) > 1) {
                    if (keys['KeyA']) car.rotation.z += 0.08;
                    if (keys['KeyD']) car.rotation.z -= 0.08;
                }

                dist = Math.floor(car.position.x);
                document.getElementById('dist').innerText = dist;
                document.getElementById('fuel-fill').style.width = Math.max(0, fuel) + '%';

                if (fuel <= 0 || Math.abs(car.rotation.z) > Math.PI * 0.75) {
                    gameActive = false; document.getElementById('game-over').style.display = 'block';
                    document.getElementById('fail-msg').innerText = fuel <= 0 ? "OUT OF FUEL!" : "FLIPPED!";
                    document.getElementById('final-dist').innerText = dist;
                }

                particles.forEach((p, idx) => {
                    p.mesh.position.add(p.v); p.life -= 0.02; p.mesh.material.opacity = p.life;
                    if (p.life <= 0) { scene.remove(p.mesh); particles.splice(idx, 1); }
                });

                fuelCans.forEach((c, idx) => {
                    if (c.position.distanceTo(car.position) < 2.5) {
                        fuel = Math.min(100, fuel + 30);
                        scene.remove(c); fuelCans.splice(idx, 1);
                    }
                });

                camera.position.x = car.position.x + 15;
                camera.position.y = car.position.y + 8;
                camera.lookAt(car.position);
            }
            renderer.render(scene, camera);
        }

        init();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>

</html>