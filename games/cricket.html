<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Champions Pro ULTIMATE</title>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Teko', sans-serif;
            overflow: hidden;
            background: #000;
        }

        #gameCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #ui-layer {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        /* --- ADVANCED SCOREBOARD --- */
        .scoreboard-v8 {
            position: absolute;
            top: 40px;
            left: 50px;
            width: 330px;
            background: rgba(20, 20, 25, 0.95);
            border: 2px solid #555;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8), inset 0 0 10px rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .top-info {
            display: flex;
            height: 115px;
            margin-bottom: 12px;
        }

        .target-content {
            flex: 1.4;
            padding: 5px 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .lbl-target {
            color: #FFEA00;
            font-size: 40px;
            font-style: italic;
            font-weight: 800;
            line-height: 0.9;
        }

        .val-target {
            color: #fff;
            font-size: 80px;
            font-weight: 800;
            line-height: 1;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .visual-red-box {
            flex: 1;
            border: 2.5px solid #e74c3c;
            border-radius: 6px;
            margin: 10px;
            background: rgba(231, 76, 60, 0.1);
            box-shadow: inset 0 0 15px rgba(231, 76, 60, 0.2);
        }

        .stat-bar {
            background: linear-gradient(90deg, #1a1a1a, #2a2a2a);
            border: 1px solid #444;
            border-radius: 6px;
            margin-bottom: 8px;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            text-transform: uppercase;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .mini-bat {
            width: 32px;
            height: 32px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23d35400"><path d="M19.16 2.05L6.34 14.87c-.12.12-.12.32 0 .44l1.41 1.42 1.42-1.42 1.41 1.42-2.12 2.12 4.24 4.24 2.12-2.12 1.41 1.41 1.42-1.41 1.41 1.42L3.48 22 2 20.52l17.16-18.47z"/></svg>') no-repeat center;
            transition: all 0.4s ease;
        }

        .mini-bat.dead {
            opacity: 0.1;
            filter: grayscale(1);
            transform: scale(0.8);
        }

        /* --- THE ADVANCED GAUGE --- */
        .gauge-area {
            position: absolute;
            top: 0;
            right: 0;
            width: 480px;
            height: 100%;
        }

        .arc-svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .arc-line {
            fill: none;
            stroke: #fff;
            stroke-width: 15;
            stroke-dasharray: 45, 25;
            stroke-linecap: round;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
        }

        .gauge-num {
            fill: #fff;
            font-size: 72px;
            font-weight: 900;
            text-anchor: middle;
            text-shadow: 4px 4px 10px #000;
        }

        .cursor-mark {
            fill: #FFEA00;
            filter: drop-shadow(0 0 20px orange);
        }

        /* --- PREMIUM GAME HEADER --- */
        .game-header-premium {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100px;
            z-index: 1000;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8) 0%, transparent 100%);
            pointer-events: none;
            display: flex;
            align-items: center;
            padding: 0 40px;
        }

        .header-inner {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: none;
        }

        .hub-back {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            color: #fff;
            pointer-events: auto;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .hub-back:hover {
            transform: translateX(-5px) scale(1.05);
        }

        .back-icon-wrap {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: 0.3s;
        }

        .hub-back:hover .back-icon-wrap {
            border-color: #FFEA00;
            box-shadow: 0 0 20px rgba(255, 234, 0, 0.4);
            color: #FFEA00;
        }

        .hub-text {
            display: flex;
            flex-direction: column;
            line-height: 1;
        }

        .hub-small {
            font-size: 14px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .hub-main {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -0.5px;
            text-transform: uppercase;
        }

        .hub-main .accent {
            color: #FFEA00;
            text-shadow: 0 0 10px rgba(255, 234, 0, 0.5);
        }

        .game-title-badge {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 25px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            font-size: 22px;
            font-weight: 800;
            color: rgba(255, 255, 255, 0.8);
            letter-spacing: 1.5px;
            text-transform: uppercase;
        }

        /* --- SCORE MESSAGE (ANIMATED) --- */
        .pop-msg {
            position: absolute;
            top: 32%;
            left: 60%;
            transform: translate(-50%, -50%);
            font-size: 180px;
            font-weight: 950;
            font-style: italic;
            color: #FFEA00;
            text-shadow: 10px 10px 0px #000, 0 0 60px rgba(255, 234, 0, 0.6);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            pointer-events: none;
        }

        .pop-msg.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.2) rotate(-5deg);
        }

        #menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(10, 10, 20, 0.9), rgba(0, 0, 0, 0.95));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .title-fancy {
            font-size: 140px;
            color: #fff;
            font-style: italic;
            font-weight: 900;
            text-transform: uppercase;
            text-shadow: 0 0 30px #FFEA00;
            margin-bottom: 30px;
            line-height: 0.9;
            text-align: center;
        }

        .btn-play {
            background: linear-gradient(to bottom, #FFEA00, #ffc400);
            border: 6px solid #fff;
            border-radius: 100px;
            padding: 20px 80px;
            font-size: 50px;
            font-weight: 950;
            cursor: pointer;
            box-shadow: 0 15px 50px rgba(255, 234, 0, 0.4);
            text-transform: uppercase;
            font-family: 'Teko', sans-serif;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 20px;
        }

        .btn-play:hover {
            transform: scale(1.1) rotate(2deg);
            filter: brightness(1.2);
        }

        .target-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .target-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #555;
            color: #fff;
            padding: 15px 30px;
            font-size: 30px;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
        }

        .target-btn.active {
            background: #FFEA00;
            color: #000;
            border-color: #fff;
            box-shadow: 0 0 20px rgba(255, 234, 0, 0.5);
        }

        .win-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            text-align: center;
        }

        .win-title {
            font-size: 150px;
            font-weight: 950;
            color: #FFEA00;
            text-shadow: 0 0 50px rgba(255, 234, 0, 0.5);
            margin-bottom: 20px;
        }

        .win-sub {
            font-size: 50px;
            color: #fff;
            margin-bottom: 40px;
        }

        /* SVG FILTER FOR TRANSPARENCY & COLOR BOOST */
        #svg-filters {
            height: 0;
            width: 0;
            position: absolute;
        }
    </style>
</head>

<body>

    <svg id="svg-filters" xmlns="http://www.w3.org/2000/svg">
        <filter id="clean-bg">
            <!-- 1. Background removal (makes white/near-white transparent) -->
            <feColorMatrix type="matrix" values="
                1 0 0 0 0
                0 1 0 0 0
                0 0 1 0 0
                -1 -1 -1 3.5 -2.2" result="transparent" />

            <!-- 2. Color Enhancement (Boost Saturation and Brightness) -->
            <feColorMatrix in="transparent" type="matrix" values="
                1.4 0 0 0 0
                0 1.4 0 0 0
                0 0 1.4 0 0
                0 0 0 1 0" result="vibrant" />

            <!-- 3. Final brightness pop -->
            <feComponentTransfer in="vibrant">
                <feFuncR type="linear" slope="1.1" />
                <feFuncG type="linear" slope="1.1" />
                <feFuncB type="linear" slope="1.1" />
            </feComponentTransfer>
        </filter>
    </svg>

    <header class="game-header-premium">
        <div class="header-inner">
            <a href="../index.html" class="hub-back">
                <div class="back-icon-wrap">
                    <i data-lucide="arrow-left" style="width:28px; height:28px"></i>
                </div>
                <div class="hub-text">
                    <span class="hub-small">Return to</span>
                    <span class="hub-main">GameHub <span class="accent">Pro</span></span>
                </div>
            </a>
            <div class="game-title-badge">
                <span>CITY CRICKET: IPL EDITION</span>
            </div>
        </div>
    </header>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div class="scoreboard-v8">
            <div class="top-info">
                <div class="target-content">
                    <div class="lbl-target">TARGET</div>
                    <div class="val-target">20</div>
                </div>
                <div class="visual-red-box"></div>
            </div>

            <div class="stat-bar">
                <span>RUNS : <span id="r-val" style="color:#FFEA00">0</span></span>
            </div>
            <div class="stat-bar">
                <span>BALLS : <span id="b-val">12</span></span>
            </div>
            <div class="stat-bar">
                <span>WICKETS : <span id="w-val">2</span></span>
                <div style="display:flex; gap:8px;" id="w-icons">
                    <div class="mini-bat"></div>
                    <div class="mini-bat"></div>
                </div>
            </div>
        </div>

        <div class="gauge-area">
            <svg class="arc-svg" viewBox="0 0 500 1000">
                <path id="gaugePath" class="arc-line" d="M 500,50 Q 150,500 500,950" />
                <text x="390" y="110" class="gauge-num" transform="rotate(-15, 390, 110)">6</text>
                <text x="300" y="270" class="gauge-num" transform="rotate(-10, 300, 270)">4</text>
                <text x="240" y="440" class="gauge-num">3</text>
                <text x="240" y="580" class="gauge-num">5</text>
                <text x="300" y="750" class="gauge-num" transform="rotate(10, 300, 750)">4</text>
                <text x="390" y="910" class="gauge-num" transform="rotate(15, 390, 910)">3</text>
                <circle id="gaugeCursor" cx="0" cy="0" r="26" class="cursor-mark" />
            </svg>
        </div>

        <div class="pop-msg" id="popMsg">SIX!</div>
    </div>

    <div id="menu">
        <h1 class="title-fancy">CITY CRICKET<br><span style="color:#FFEA00">IPL EDITION</span></h1>

        <div class="target-selector">
            <button class="target-btn" onclick="setTarget(25, this)">EASY (25)</button>
            <button class="target-btn active" onclick="setTarget(45, this)">MEDIUM (45)</button>
            <button class="target-btn" onclick="setTarget(70, this)">HARD (70)</button>
        </div>

        <button class="btn-play" onclick="play()">START MATCH</button>
    </div>

    <div id="win-overlay" class="win-overlay">
        <h1 id="win-status" class="win-title">YOU WIN!</h1>
        <p id="win-detail" class="win-sub">Scored 46 Runs</p>
        <button class="btn-play" onclick="location.reload()">PLAY AGAIN</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const assets = {
            bg: new Image(),
            batsman: new Image()
        };
        assets.bg.src = '../assets/stadium_bg_v2.png';
        assets.batsman.src = '../assets/batsman_v2.png';

        let state = 'menu';
        let stats = { runs: 0, balls: 18, wickets: 3, target: 45 };
        let selectedTarget = 45;
        let ball = { x: 0, y: 0, z: 0, active: false, vx: 0, vy: 0, vz: 0, trail: [] };
        let particles = [];
        let shake = 0;

        function init() {
            window.addEventListener('resize', resize);
            resize();
            window.addEventListener('mousedown', hit);
            window.addEventListener('touchstart', hit);
            requestAnimationFrame(loop);
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function setTarget(val, btn) {
            selectedTarget = val;
            document.querySelectorAll('.target-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function play() {
            document.getElementById('menu').style.display = 'none';
            stats.runs = 0;
            stats.balls = 18; // 3 Overs for IPL
            stats.wickets = 3;
            stats.target = selectedTarget;
            document.querySelector('.val-target').innerText = stats.target;
            updateUI();
            newDelivery();
        }

        function newDelivery() {
            if (stats.runs >= stats.target) {
                endGame(true);
                return;
            }
            if (stats.balls <= 0 || stats.wickets <= 0) {
                endGame(stats.runs >= stats.target);
                return;
            }
            state = 'bowling';
            ball.active = false;
            ball.trail = [];
            setTimeout(() => {
                ball.x = 0; ball.y = 15; ball.z = 100;
                const speed = 1.5 + Math.random() * 0.7;
                ball.vz = -speed;
                ball.vy = -0.15;
                ball.vx = (Math.random() - 0.5) * 0.4;
                ball.active = true;
            }, 1000);
        }

        function loop() {
            update();
            render();
            requestAnimationFrame(loop);
        }

        function createParticles(x, y, color) {
            for (let i = 0; i < 15; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 12,
                    vy: (Math.random() - 0.5) * 12,
                    life: 1,
                    color
                });
            }
        }

        function update() {
            if (state === 'menu') return;

            if (ball.active) {
                ball.trail.push({ x: ball.x, y: ball.y, z: ball.z });
                if (ball.trail.length > 6) ball.trail.shift();

                ball.x += ball.vx; ball.y += ball.vy; ball.z += ball.vz;
                if (ball.z < 0) { ball.active = false; outcome('MISS', 0); }
                if (ball.y < 0) {
                    ball.y = 0; ball.vy = -ball.vy * 0.75;
                    createParticles(project(ball.x, 0, ball.z).x, project(ball.x, 0, ball.z).y, '#fff');
                }
                ball.vy -= 0.01;
            }

            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx; p.y += p.vy; p.life -= 0.025;
                if (p.life <= 0) particles.splice(i, 1);
            }

            if (shake > 0) shake *= 0.9;

            const path = document.getElementById('gaugePath');
            if (path) {
                const len = path.getTotalLength();
                const perc = (Math.sin(Date.now() * 0.007) + 1) / 2;
                const p = path.getPointAtLength(perc * len);
                const mark = document.getElementById('gaugeCursor');
                mark.setAttribute('cx', p.x); mark.setAttribute('cy', p.y);
            }
        }

        function hit() {
            if (state !== 'bowling' || !ball.active) return;
            const timing = Math.abs(ball.z - 18);
            if (timing < 18) {
                state = 'hit';
                const proj = project(ball.x, ball.y, ball.z);
                createParticles(proj.x, proj.y, '#FFEA00');

                ball.vz = 4.0; ball.vy = 2.2; ball.vx = (Math.random() - 0.5) * 18;

                let r = 1; let m = "1 RUN";
                if (timing < 6) { r = 6; m = "SIX!"; shake = 25; }
                else if (timing < 11) { r = 4; m = "FOUR"; shake = 15; }

                outcome(m, r);
            }
        }

        function outcome(txt, r) {
            const el = document.getElementById('popMsg');
            el.innerText = txt; el.classList.add('show');
            stats.runs += r; stats.balls--;
            if (txt === 'MISS') stats.wickets--;
            updateUI();
            setTimeout(() => {
                el.classList.remove('show');
                newDelivery();
            }, 2000);
        }

        function updateUI() {
            document.getElementById('r-val').innerText = stats.runs;
            document.getElementById('b-val').innerText = stats.balls;
            document.getElementById('w-val').innerText = stats.wickets;

            const wIconsWrap = document.getElementById('w-icons');
            wIconsWrap.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const bat = document.createElement('div');
                bat.className = 'mini-bat' + (i >= stats.wickets ? ' dead' : '');
                wIconsWrap.appendChild(bat);
            }
        }

        function endGame(isWin) {
            state = 'menu';
            const overlay = document.getElementById('win-overlay');
            const status = document.getElementById('win-status');
            const detail = document.getElementById('win-detail');

            overlay.style.display = 'flex';
            if (isWin) {
                status.innerText = "CHAMPIONS!";
                status.style.color = "#FFEA00";
                detail.innerText = `Target Achieved! Scored ${stats.runs} Runs`;
            } else {
                status.innerText = "MATCH LOST";
                status.style.color = "#e74c3c";
                detail.innerText = `You fell short by ${stats.target - stats.runs} Runs`;
            }
        }

        function project(x, y, z) {
            const f = 900 / (900 + z * 10);
            return {
                x: (canvas.width / 2) + x * 95 * f,
                y: (canvas.height * 0.7) - y * 70 * f + (z * 6 * f),
                s: f
            };
        }

        function render() {
            ctx.save();
            if (shake > 0.5) ctx.translate((Math.random() - 0.5) * shake, (Math.random() - 0.5) * shake);

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (assets.bg.complete) ctx.drawImage(assets.bg, 0, 0, canvas.width, canvas.height);

            const cx = canvas.width / 2;
            const pTopY = canvas.height * 0.65;
            const pBotY = canvas.height * 0.98;
            ctx.fillStyle = '#CBB677';
            ctx.beginPath();
            ctx.moveTo(cx - 70, pTopY); ctx.lineTo(cx + 70, pTopY);
            ctx.lineTo(cx + 550, pBotY); ctx.lineTo(cx - 550, pBotY);
            ctx.fill();

            ctx.strokeStyle = '#fff'; ctx.lineWidth = 4;
            const lineY = pBotY - 110;
            ctx.beginPath();
            ctx.moveTo(cx - 420, lineY); ctx.lineTo(cx + 420, lineY);
            ctx.stroke();
            ctx.beginPath();
            ctx.strokeRect(cx - 340, lineY, 340, 75);

            const sx = cx - 260; const sy = lineY;
            ctx.shadowBlur = 20; ctx.shadowColor = '#f00';
            ctx.fillStyle = '#ff2200';
            for (let i = 0; i < 3; i++) ctx.fillRect(sx + i * 24, sy - 115, 9, 115);
            ctx.fillRect(sx - 5, sy - 115, 72, 12);
            ctx.shadowBlur = 0;

            if (assets.batsman.complete) {
                const bW = canvas.width * 0.25;
                const bH = bW * 1.5;
                const bX = cx - (bW * 0.9);
                const bY = sy - bH + 25;
                ctx.save();
                ctx.filter = 'url(#clean-bg)';
                if (state === 'hit') {
                    ctx.translate(bX + bW / 2, bY + bH);
                    ctx.rotate(-0.4);
                    ctx.translate(-(bX + bW / 2), -(bY + bH));
                }
                ctx.drawImage(assets.batsman, bX, bY, bW, bH);
                ctx.restore();
            }

            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 5, 5);
            });
            ctx.globalAlpha = 1;

            if (ball.active) {
                ctx.strokeStyle = 'rgba(255,255,255,0.4)';
                ctx.lineWidth = 12;
                ctx.beginPath();
                ball.trail.forEach((t, i) => {
                    const p = project(t.x, t.y, t.z);
                    if (i === 0) ctx.moveTo(p.x, p.y);
                    else ctx.lineTo(p.x, p.y);
                });
                ctx.stroke();

                const p = project(ball.x, ball.y, ball.z);
                ctx.beginPath(); ctx.arc(p.x, p.y, 26 * p.s, 0, Math.PI * 2);
                ctx.fillStyle = '#fff';
                ctx.shadowBlur = 25; ctx.shadowColor = '#fff';
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            ctx.restore();
        }

        init();
        lucide.createIcons();
    </script>
</body>

</html>