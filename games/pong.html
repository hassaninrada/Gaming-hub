<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Pong | GameHub Pro</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .game-wrapper {
            max-width: 900px;
            margin: 40px auto;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
        }

        .stats-bar {
            padding: 20px 40px;
            background: rgba(124, 77, 255, 0.1);
            display: flex;
            justify-content: space-around;
            font-size: 20px;
            font-weight: 800;
            border-bottom: 1px solid var(--glass-border);
        }

        .score-val {
            color: var(--accent-secondary);
            font-family: 'Inter', sans-serif;
            font-size: 32px;
            text-shadow: 0 0 15px rgba(124, 77, 255, 0.5);
        }

        .game-body {
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #000;
            position: relative;
        }

        canvas {
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            box-shadow: 0 0 50px rgba(124, 77, 255, 0.2);
            background: #080808;
        }

        .game-controls {
            padding: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.2);
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10;
        }
    </style>
</head>

<body class="dark-theme">
    <div class="bg-glow-container">
        <div class="glow-sphere sphere-1"></div>
        <div class="glow-sphere sphere-2"></div>
    </div>

    <header class="main-header" style="position: relative; background: transparent; border: none;">
        <div class="nav-container">
            <a href="../index.html" class="logo" style="text-decoration: none; color: inherit;">
                <i data-lucide="arrow-left"></i>
                <span>BACK TO <span class="accent-text">HUB</span></span>
            </a>
            <h2 style="font-weight:800; letter-spacing:-1px">CYBER PONG 2.0</h2>
        </div>
    </header>

    <div class="game-wrapper">
        <div class="stats-bar">
            <span>PLAYER <span class="score-val" id="playerScore">0</span></span>
            <span>AI <span class="score-val" id="aiScore">0</span></span>
        </div>

        <div class="game-body">
            <div class="overlay" id="startScreen">
                <h1 style="font-size:4rem; color:#fff; text-shadow:0 0 20px #a855f7">READY?</h1>
                <p style="color:#ccc; margin-bottom:20px">Move with MOUSE</p>
                <button class="btn-primary" onclick="startGame()">INITIATE MATCH</button>
            </div>
            <canvas id="pongCanvas" width="800" height="500"></canvas>
        </div>

        <div class="game-controls">
            <button class="btn-secondary" onclick="resetScore()">RESET SCORE</button>
        </div>
    </div>

    <script src="../js/shared.js"></script>
    <script>
        lucide.createIcons();
        const canvas = document.getElementById('pongCanvas');
        const ctx = canvas.getContext('2d');

        // Game Objects
        const ball = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            radius: 8,
            speed: 7,
            dx: 5,
            dy: 5,
            color: '#fff'
        };

        const user = {
            x: 10,
            y: canvas.height / 2 - 50,
            w: 15,
            h: 100,
            color: '#00e5ff',
            score: 0
        };

        const com = {
            x: canvas.width - 25,
            y: canvas.height / 2 - 50,
            w: 15,
            h: 100,
            color: '#ef4444',
            score: 0
        };

        const net = {
            x: canvas.width / 2 - 1,
            y: 0,
            w: 2,
            h: 10,
            color: 'rgba(255,255,255,0.2)'
        };

        let frames = 0;
        let gameActive = false;
        let particles = [];

        function drawRect(x, y, w, h, color, glow = false) {
            ctx.fillStyle = color;
            if (glow) {
                ctx.shadowBlur = 20;
                ctx.shadowColor = color;
            }
            ctx.fillRect(x, y, w, h);
            ctx.shadowBlur = 0;
        }

        function drawCircle(x, y, r, color) {
            ctx.fillStyle = color;
            ctx.shadowBlur = 15;
            ctx.shadowColor = color;
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2, false);
            ctx.closePath();
            ctx.fill();
            ctx.shadowBlur = 0;
        }

        function drawNet() {
            for (let i = 0; i <= canvas.height; i += 25) {
                drawRect(net.x, net.y + i, net.w, net.h, net.color);
            }
        }

        function resetBall() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.speed = 7;
            ball.dx = -ball.dx; // Serve to scorer
            // Create particle explosion at center
            for (let i = 0; i < 20; i++) {
                particles.push({
                    x: canvas.width / 2, y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 10, vy: (Math.random() - 0.5) * 10,
                    life: 1.0, color: '#fff'
                });
            }
        }

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            gameActive = true;
            if (typeof GameHubAudio !== 'undefined') GameHubAudio.playMusic();
            loop();
        }

        function update() {
            if (!gameActive) return;
            frames++;

            // Move ball
            ball.x += ball.dx;
            ball.y += ball.dy;

            // Wall Collision
            if (ball.y + ball.radius > canvas.height || ball.y - ball.radius < 0) {
                ball.dy = -ball.dy;
                // Wall hit effect
                // if(typeof GameHubAudio !== 'undefined') GameHubAudio.play('click');
            }

            // Paddle Collision
            let player = (ball.x < canvas.width / 2) ? user : com;

            // Simple AABB
            if (ball.x + ball.radius > player.x && ball.x - ball.radius < player.x + player.w &&
                ball.y + ball.radius > player.y && ball.y - ball.radius < player.y + player.h) {

                // Hit Logic
                if (typeof GameHubAudio !== 'undefined') GameHubAudio.play('move');

                // Calculate angle
                let collidePoint = ball.y - (player.y + player.h / 2);
                collidePoint = collidePoint / (player.h / 2); // -1 to 1
                let angleRad = collidePoint * (Math.PI / 4); // 45 deg max

                let direction = (ball.x < canvas.width / 2) ? 1 : -1;

                ball.dx = direction * ball.speed * Math.cos(angleRad);
                ball.dy = ball.speed * Math.sin(angleRad);

                // Speed up per hit
                ball.speed += 0.5;
                if (ball.speed > 20) ball.speed = 20;

                // Hit particles
                for (let i = 0; i < 10; i++) {
                    particles.push({
                        x: ball.x, y: ball.y,
                        vx: (Math.random() - 0.5) * 10, vy: (Math.random() - 0.5) * 10,
                        life: 0.8, color: player.color
                    });
                }
            }

            // AI Logic
            // Simple tracking with delay
            let targetY = ball.y - com.h / 2;
            let diff = targetY - com.y;
            com.y += diff * 0.1; // Smooth follow lerp

            // Constraint paddles
            user.y = Math.max(0, Math.min(canvas.height - user.h, user.y));
            com.y = Math.max(0, Math.min(canvas.height - com.h, com.y));

            // Scoring
            if (ball.x - ball.radius < 0) {
                com.score++;
                if (typeof GameHubAudio !== 'undefined') GameHubAudio.play('loss');
                updateScoreBoard();
                resetBall();
            } else if (ball.x + ball.radius > canvas.width) {
                user.score++;
                if (typeof GameHubAudio !== 'undefined') GameHubAudio.play('win');
                updateScoreBoard();
                resetBall();
            }

            // Particles update
            particles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.05;
                if (p.life <= 0) particles.splice(i, 1);
            });
        }

        function updateScoreBoard() {
            document.getElementById('playerScore').innerText = user.score;
            document.getElementById('aiScore').innerText = com.score;
        }

        function resetScore() {
            user.score = 0;
            com.score = 0;
            updateScoreBoard();
        }

        function draw() {
            // Trail effect (clear with alpha)
            ctx.fillStyle = 'rgba(8, 8, 8, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawNet();
            drawRect(user.x, user.y, user.w, user.h, user.color, true);
            drawRect(com.x, com.y, com.w, com.h, com.color, true);
            drawCircle(ball.x, ball.y, ball.radius, ball.color);

            // Particles
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            });
        }

        function loop() {
            if (gameActive) {
                update();
                draw();
                requestAnimationFrame(loop);
            }
        }

        // Mouse Control
        canvas.addEventListener('mousemove', e => {
            let rect = canvas.getBoundingClientRect();
            user.y = e.clientY - rect.top - user.h / 2;
        });

    </script>
</body>

</html>