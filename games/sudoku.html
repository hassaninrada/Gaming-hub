<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Pro | GameHub Pro</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .game-wrapper {
            max-width: 600px;
            margin: 40px auto;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
        }

        .stats-bar {
            padding: 15px 40px;
            background: rgba(124, 77, 255, 0.1);
            display: flex;
            justify-content: space-around;
            font-size: 14px;
            font-weight: 800;
            border-bottom: 1px solid var(--glass-border);
        }

        .stat-val {
            color: var(--accent-secondary);
            margin-left: 5px;
        }

        .game-body {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 45px);
            gap: 2px;
            background: var(--glass-border);
            padding: 2px;
            border-radius: 12px;
        }

        .cell {
            width: 45px;
            height: 45px;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-muted);
        }

        .cell:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .cell.fixed {
            color: var(--accent-secondary);
            background: rgba(0, 229, 255, 0.05);
        }

        .cell.selected {
            background: rgba(124, 77, 255, 0.4);
            border: 1px solid var(--accent-primary);
            color: #fff;
        }

        .cell.highlighted {
            background: rgba(124, 77, 255, 0.1);
        }

        .cell.error {
            color: #ff1744;
            text-shadow: 0 0 10px #ff1744;
        }

        /* Subgrid borders */
        .cell:nth-child(3n) {
            border-right: 2px solid var(--accent-primary);
        }

        .cell:nth-child(9n) {
            border-right: none;
        }

        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 2px solid var(--accent-primary);
        }

        .num-pad {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .num-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: #fff;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
        }

        .num-btn:hover {
            background: var(--accent-primary);
            border-color: transparent;
        }

        .game-controls {
            padding: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body class="dark-theme">
    <div class="bg-glow-container">
        <div class="glow-sphere sphere-1"></div>
        <div class="glow-sphere sphere-2"></div>
    </div>

    <header class="main-header" style="position: relative; background: transparent; border: none;">
        <div class="nav-container">
            <a href="../index.html" class="logo" style="text-decoration: none; color: inherit;">
                <i data-lucide="arrow-left"></i>
                <span>BACK TO <span class="accent-text">HUB</span></span>
            </a>
            <h2 style="font-weight:800; letter-spacing:-1px">SUDOKU PRO</h2>
        </div>
    </header>

    <div class="game-wrapper">
        <div class="stats-bar">
            <span>DIFFICULTY: <span class="stat-val" id="diff">MEDIUM</span></span>
            <span>MISTAKES: <span class="stat-val" id="mistakes">0</span></span>
        </div>

        <div class="game-body">
            <div class="sudoku-grid" id="grid"></div>

            <div class="num-pad" id="pad"></div>
        </div>

        <div class="game-controls">
            <button class="btn-primary" onclick="initGame()">NEW MATRIX</button>
            <button class="btn-primary" onclick="getAiHint()">AI SOLV-HINT</button>
            <button class="btn-secondary" onclick="goBack()">EXIT</button>
        </div>
    </div>

    <script src="../js/shared.js"></script>
    <script>
        lucide.createIcons();

        let grid = [], solution = Array(81).fill(0), selected = null, mistakes = 0;

        function initGame() {
            const gridEl = document.getElementById('grid');
            gridEl.innerHTML = '';
            grid = Array(81).fill(0);
            generateSolution();
            mistakes = 0; document.getElementById('mistakes').textContent = 0;

            for (let i = 0; i < 81; i++) {
                const el = document.createElement('div');
                el.className = 'cell';
                if (Math.random() > 0.6) {
                    grid[i] = solution[i];
                    el.textContent = grid[i];
                    el.className += ' fixed';
                }
                el.onclick = () => selectCell(i);
                gridEl.appendChild(el);
            }

            const pad = document.getElementById('pad');
            pad.innerHTML = '';
            for (let i = 1; i <= 9; i++) {
                const b = document.createElement('button');
                b.className = 'num-btn'; b.textContent = i;
                b.onclick = () => place(i);
                pad.appendChild(b);
            }
            if (typeof GameHubAudio !== 'undefined') GameHubAudio.playMusic();
        }

        function selectCell(idx) {
            selected = idx;
            const cells = document.querySelectorAll('.cell');
            cells.forEach(c => c.classList.remove('selected', 'highlighted'));

            const r = Math.floor(idx / 9);
            const c = idx % 9;
            const boxR = Math.floor(r / 3) * 3;
            const boxC = Math.floor(c / 3) * 3;

            cells.forEach((cell, i) => {
                const tr = Math.floor(i / 9);
                const tc = i % 9;
                const tboxR = Math.floor(tr / 3) * 3;
                const tboxC = Math.floor(tc / 3) * 3;

                if (tr === r || tc === c || (tboxR === boxR && tboxC === boxC)) {
                    cell.classList.add('highlighted');
                }
            });
            cells[idx].classList.add('selected');
        }

        function generateSolution() {
            // Robust-ish shuffle of the identity matrix
            const base = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            for (let i = 0; i < 81; i++) {
                const row = Math.floor(i / 9);
                const col = i % 9;
                solution[i] = base[(row * 3 + Math.floor(row / 3) + col) % 9];
            }
        }

        function place(n) {
            if (selected === null) return;
            const cells = document.querySelectorAll('.cell');
            if (cells[selected].classList.contains('fixed')) return;

            grid[selected] = n;
            cells[selected].textContent = n;

            if (n !== solution[selected]) {
                if (typeof GameHubAudio !== 'undefined') GameHubAudio.play('loss');
                cells[selected].classList.add('error');
                mistakes++; document.getElementById('mistakes').textContent = mistakes;
                if (mistakes >= 5) { alert("MATRIX OVERLOAD - REBOOTING."); initGame(); }
            } else {
                if (typeof GameHubAudio !== 'undefined') GameHubAudio.play('move');
                cells[selected].classList.remove('error');
                checkWin();
            }
        }

        async function getAiHint() {
            if (selected === null) { alert("NEURAL LINK: Select a cell first."); return; }
            if (grid[selected] !== 0 && !document.querySelectorAll('.cell')[selected].classList.contains('error')) return;

            const cell = document.querySelectorAll('.cell')[selected];
            cell.textContent = "?";
            cell.style.color = "var(--accent-primary)";

            // Artificial "thinking" delay
            await new Promise(r => setTimeout(r, 600));

            place(solution[selected]);
        }

        function checkWin() {
            if (grid.every((v, i) => v === solution[i])) {
                if (typeof GameHubAudio !== 'undefined') GameHubAudio.play('win');
                GameHubStats.reportScore('sudoku', 2500);
                alert("MATRIX STABILIZED! Score: 2500");
                initGame();
            }
        }

        function goBack() {
            if (typeof GameHubAudio !== 'undefined') GameHubAudio.stopMusic();
            window.location.href = '../index.html';
        }
        initGame();
    </script>
</body>

</html>