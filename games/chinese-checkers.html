<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Star Checkers | GameHub Pro</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .game-wrapper {
            max-width: 900px;
            margin: 40px auto;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
        }

        .stats-bar {
            padding: 20px 40px;
            background: rgba(124, 77, 255, 0.1);
            display: flex;
            justify-content: space-around;
            font-size: 16px;
            font-weight: 800;
            border-bottom: 1px solid var(--glass-border);
        }

        .stat-val {
            color: var(--accent-secondary);
            margin-left: 5px;
        }

        .game-body {
            padding: 40px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .board-container {
            position: relative;
            width: 600px;
            height: 600px;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIj48cGF0aCBkPSJNMzAwIDUwIEw1NTAgNDc1IEw1MCA0NzUgWiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMDUpIiBzdHJva2Utd2lkdGg9IjIiLz48cGF0aCBkPSJNMzAwIDU1MCBMNTUwIDEyNSBMNTAgMTI1IFoiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIgc3Ryb2tlLXdpZHRoPSIyIi8+PC9zdmc+');
            background-size: cover;
        }

        .slot {
            position: absolute;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.3s;
        }

        .slot:hover:not(.occupied) {
            background: rgba(0, 229, 255, 0.2);
            box-shadow: 0 0 10px var(--accent-secondary);
        }

        .marble {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            position: absolute;
            top: 1px;
            left: 1px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .marble.red {
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #ef4444);
            border: 2px solid #ef4444;
        }

        .marble.blue {
            background: radial-gradient(circle at 30% 30%, #4dabf7, #3b82f6);
            border: 2px solid #3b82f6;
        }

        .marble.green {
            background: radial-gradient(circle at 30% 30%, #51cf66, #22c55e);
            border: 2px solid #22c55e;
        }

        .marble.yellow {
            background: radial-gradient(circle at 30% 30%, #ffd43b, #eab308);
            border: 2px solid #eab308;
        }

        .marble.selected {
            transform: scale(1.4);
            box-shadow: 0 0 20px #fff;
            z-index: 100;
        }

        .valid-move {
            background: rgba(124, 77, 255, 0.4) !important;
            box-shadow: 0 0 15px var(--accent-primary) !important;
        }
    </style>
</head>

<body class="dark-theme">
    <div class="bg-glow-container">
        <div class="glow-sphere sphere-1"></div>
        <div class="glow-sphere sphere-2"></div>
    </div>

    <header class="main-header" style="position: relative; background: transparent; border: none;">
        <div class="nav-container">
            <a href="index.html" class="logo" style="text-decoration: none; color: inherit;">
                <i data-lucide="arrow-left"></i>
                <span>BACK TO <span class="accent-text">HUB</span></span>
            </a>
            <h2 style="font-weight:800; letter-spacing:-1px">NEON STAR CHECKERS</h2>
        </div>
    </header>

    <div class="game-wrapper">
        <div class="stats-bar">
            <span>TURN: <span class="stat-val" id="turn">RED FLEET</span></span>
            <span>MOVES: <span class="stat-val" id="moves">0</span></span>
        </div>

        <div class="game-body">
            <div class="board-container" id="board">
                <!-- Slots generated by JS -->
            </div>
            <p class="hint-text">Relocate your energy nodes to the opposing star point. Jump over allies to surge ahead.
            </p>
        </div>

        <div class="game-controls">
            <button class="btn-primary" onclick="initGame()">RESET SIMULATION</button>
            <button class="btn-secondary" onclick="window.location.href='index.html'">EXIT SYSTEM</button>
        </div>
    </div>

    <script src="../js/shared.js"></script>
    <script>
        lucide.createIcons();

        const boardEl = document.getElementById('board');
        const turnEl = document.getElementById('turn');
        const movesEl = document.getElementById('moves');

        let slots = [];
        let p1Stones = [], p2Stones = [];
        let selectedStone = null;
        let turn = 'red';
        let moves = 0;

        function initGame() {
            boardEl.innerHTML = '';
            slots = [];
            // Generate hex grid for star shape
            // A star is made of a central hexagon and 6 triangles.
            // Coordinate system: q, r
            for (let r = -8; r <= 8; r++) {
                for (let q = -8; q <= 8; q++) {
                    if (isValid(q, r)) {
                        const x = 300 + q * 25 + r * 12.5;
                        const y = 300 + r * 22;
                        const slot = document.createElement('div');
                        slot.className = 'slot';
                        slot.style.left = `${x}px`;
                        slot.style.top = `${y}px`;
                        slot.dataset.q = q;
                        slot.dataset.r = r;
                        slot.onclick = () => handleSlotClick(q, r);
                        boardEl.appendChild(slot);
                        slots.push({ q, r, el: slot, occupied: null });
                    }
                }
            }

            // Initial stones (simplified for 2 players)
            slots.forEach(s => {
                if (s.r < -4) placeInitial(s, 'red');
                if (s.r > 4) placeInitial(s, 'blue');
            });

            turn = 'red';
            moves = 0;
            updateUI();
        }

        function isValid(q, r) {
            // Hexagon logic (q + r + s = 0)
            const s = -q - r;
            // Center hexagon (r <= 4 and q <= 4 and s <= 4)
            if (Math.abs(r) <= 4 && Math.abs(q) <= 4 && Math.abs(s) <= 4) return true;
            // Tips of the star
            if (r < -4 && q >= -4 && q <= 4 && -q - r <= 8 && -q - r > 4) return true; // Top
            if (r > 4 && q <= 4 && q >= -4 && -q - r >= -8 && -q - r < -4) return true; // Bottom
            // Other tips omitted for simplicity in 2-player version board, but could be added
            return false;
        }

        function placeInitial(s, color) {
            const marble = document.createElement('div');
            marble.className = `marble ${color}`;
            s.el.appendChild(marble);
            s.occupied = { color, el: marble };
        }

        function handleSlotClick(q, r) {
            const slot = slots.find(s => s.q === q && s.r === r);
            if (slot.occupied && slot.occupied.color === turn) {
                // Select stone
                if (selectedStone) selectedStone.occupied.el.classList.remove('selected');
                selectedStone = slot;
                slot.occupied.el.classList.add('selected');
                if (typeof GameHubAudio !== 'undefined') GameHubAudio.play('click');
            } else if (selectedStone) {
                // Try move
                moveStone(selectedStone, slot);
            }
        }

        function moveStone(from, to) {
            if (to.occupied) return;

            // Simplified move logic: 1 step or jump
            const dq = Math.abs(from.q - to.q);
            const dr = Math.abs(from.r - to.r);
            const ds = Math.abs((-from.q - from.r) - (-to.q - to.r));

            const dist = (dq + dr + ds) / 2;

            if (dist === 1) {
                // Single step
                finishMove(from, to);
            } else if (dist === 2) {
                // Check jump
                const mq = (from.q + to.q) / 2;
                const mr = (from.r + to.r) / 2;
                const mid = slots.find(s => s.q === mq && s.r === mr);
                if (mid && mid.occupied) {
                    finishMove(from, to);
                }
            }
        }

        function finishMove(from, to) {
            const stone = from.occupied;
            from.occupied = null;
            to.occupied = stone;
            to.el.appendChild(stone.el);
            stone.el.classList.remove('selected');
            selectedStone = null;

            moves++;
            turn = turn === 'red' ? 'blue' : 'red';
            updateUI();
            if (typeof GameHubAudio !== 'undefined') GameHubAudio.play('move');
        }

        function updateUI() {
            turnEl.innerText = `${turn.toUpperCase()} FLEET`;
            turnEl.style.color = turn === 'red' ? '#ff6b6b' : '#4dabf7';
            movesEl.innerText = moves;
        }

        initGame();
    </script>
</body>

</html>