<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zen Archery | Ultra-Correct V11</title>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Inter:wght@400;900&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root {
            --accent: #FF5252;
            --gold: #FFD600;
            --sky: #E3F2FD;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--sky);
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        #ui {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 100;
            padding: 30px;
        }

        .hud {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 20px;
            border: 4px solid #000;
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.1);
        }

        .label {
            font-size: 10px;
            font-weight: 900;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .val {
            font-family: 'Bungee', cursive;
            font-size: 36px;
            color: #000;
            line-height: 1;
        }

        .wind-box {
            text-align: center;
            position: relative;
        }

        #wind-arrow {
            font-size: 50px;
            color: var(--accent);
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
            transition: transform 0.4s;
        }

        #overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            pointer-events: auto;
            color: #fff;
            text-align: center;
        }

        .ov-title {
            font-family: 'Bungee';
            font-size: 100px;
            color: var(--gold);
            margin-bottom: 10px;
        }

        .play-btn {
            background: var(--accent);
            color: #fff;
            border: 4px solid #fff;
            padding: 20px 60px;
            font-family: 'Bungee';
            font-size: 28px;
            cursor: pointer;
            border-radius: 100px;
            box-shadow: 0 12px 0 #b71c1c;
            transition: 0.2s;
        }

        .play-btn:active {
            transform: translateY(6px);
            box-shadow: 0 6px 0 #b71c1c;
        }

        .power-bar {
            position: fixed;
            left: 40px;
            top: 50%;
            transform: translateY(-50%);
            height: 350px;
            width: 20px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            border: 3px solid #000;
            overflow: hidden;
        }

        #power-fill {
            width: 100%;
            height: 0%;
            background: linear-gradient(to top, #4CAF50, #FFD600, #FF5252);
            position: absolute;
            bottom: 0;
        }
    </style>
</head>

<body>
    <div id="ui">
        <div class="hud">
            <div class="card">
                <div class="label">PRECISION SCORE</div>
                <div id="score" class="val">0</div>
            </div>
            <div class="wind-box">
                <div class="card">
                    <div class="label">WIND TURBULENCE</div>
                    <div id="wind-val" class="val">0</div>
                    <div id="wind-arrow">âž”</div>
                </div>
            </div>
            <div class="card">
                <div class="label">QUIVER STOCK</div>
                <div id="arrows" class="val">12</div>
            </div>
        </div>
    </div>

    <div class="power-bar">
        <div id="power-fill"></div>
    </div>

    <div id="overlay">
        <h1 class="ov-title">MASTERY REACHED</h1>
        <div id="final-score" style="font-size:32px; font-weight:900; margin-bottom:40px;">Final Score: 0000</div>
        <button class="play-btn" onclick="location.reload()">TRY AGAIN</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        /**
         * ZEN ARCHERY V11: THE ULTRA-CORRECT ARENA
         * Based on "Archery Arena" Side-View Mechanics.
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        const state = {
            score: 0, arrows: 12,
            isDrawing: false, pPoint: { x: 0, y: 0 },
            wind: (Math.random() - 0.5) * 8,
            activeArrows: [], targets: [],
            gameActive: true
        };

        const Archer = { x: 200, y: height - 250, angle: 0, power: 0 };

        function spawnTarget() {
            state.targets.push({
                x: width - 250, y: 150 + Math.random() * (height - 400),
                radius: 45, speed: 2 + Math.random() * 3, dir: 1
            });
        }
        spawnTarget();

        window.addEventListener('mousedown', (e) => {
            if (!state.gameActive || state.arrows <= 0) return;
            state.isDrawing = true;
            state.pPoint = { x: e.clientX, y: e.clientY };
        });

        window.addEventListener('mousemove', (e) => {
            if (state.isDrawing) {
                const dx = state.pPoint.x - e.clientX;
                const dy = state.pPoint.y - e.clientY;
                Archer.angle = Math.atan2(dy, dx);
                Archer.power = Math.min(Math.sqrt(dx * dx + dy * dy) / 3, 100);
                document.getElementById('power-fill').style.height = Archer.power + '%';
            }
        });

        window.addEventListener('mouseup', () => {
            if (state.isDrawing) {
                state.isDrawing = false;
                document.getElementById('power-fill').style.height = '0%';
                if (Archer.power > 15) fire();
            }
        });

        function fire() {
            state.arrows--;
            document.getElementById('arrows').innerText = state.arrows;
            state.activeArrows.push({
                x: Archer.x, y: Archer.y,
                vx: Math.cos(Archer.angle) * (Archer.power * 0.3),
                vy: Math.sin(Archer.angle) * (Archer.power * 0.3),
                angle: Archer.angle, active: true
            });
            gsap.to(document.body, { x: 5, duration: 0.05, yoyo: true, repeat: 3 });
        }

        function update() {
            if (!state.gameActive) return;
            document.getElementById('wind-val').innerText = Math.abs(Math.round(state.wind * 10));
            document.getElementById('wind-arrow').style.transform = `rotate(${state.wind > 0 ? 0 : 180}deg)`;

            state.targets.forEach(t => {
                t.y += t.speed * t.dir;
                if (t.y < 100 || t.y > height - 250) t.dir *= -1;
            });

            state.activeArrows.forEach((a, i) => {
                if (!a.active) return;
                a.vx += state.wind * 0.005; a.vy += 0.15;
                a.x += a.vx; a.y += a.vy;
                a.angle = Math.atan2(a.vy, a.vx);

                state.targets.forEach((t, ti) => {
                    const d = Math.sqrt((a.x - t.x) ** 2 + (a.y - t.y) ** 2);
                    if (d < t.radius) {
                        a.active = false;
                        const pts = d < t.radius * 0.2 ? 1000 : 200;
                        state.score += pts;
                        document.getElementById('score').innerText = state.score;
                        state.targets.splice(ti, 1);
                        spawnTarget();
                        state.wind = (Math.random() - 0.5) * 10;
                    }
                });

                if (a.x > width || a.y > height || a.x < 0) {
                    a.active = false;
                    if (state.arrows === 0 && state.activeArrows.every(arr => !arr.active)) endGame();
                }
            });
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);

            // Background
            ctx.fillStyle = "#8BC34A";
            ctx.fillRect(0, height - 120, width, 120);

            // Archer Frame
            ctx.fillStyle = "#3E2723";
            ctx.fillRect(Archer.x - 20, Archer.y, 40, 150);

            // Trajectory
            if (state.isDrawing) {
                ctx.setLineDash([5, 10]); ctx.strokeStyle = "rgba(0,0,0,0.2)"; ctx.beginPath();
                let tx = Archer.x, ty = Archer.y, tvx = Math.cos(Archer.angle) * (Archer.power * 0.3), tvy = Math.sin(Archer.angle) * (Archer.power * 0.3);
                for (let i = 0; i < 40; i++) {
                    ctx.lineTo(tx, ty); tvx += state.wind * 0.005; tvy += 0.15; tx += tvx; ty += tvy;
                }
                ctx.stroke(); ctx.setLineDash([]);
            }

            // Target Rendering
            state.targets.forEach(t => {
                ctx.shadowBlur = 10; ctx.shadowColor = "rgba(0,0,0,0.2)";
                ctx.lineWidth = 4; ctx.strokeStyle = "#000"; ctx.fillStyle = "#fff";
                ctx.beginPath(); ctx.arc(t.x, t.y, t.radius, 0, Math.PI * 2); ctx.fill(); ctx.stroke();
                ctx.fillStyle = "#f44336"; ctx.beginPath(); ctx.arc(t.x, t.y, t.radius * 0.6, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = "#ffeb3b"; ctx.beginPath(); ctx.arc(t.x, t.y, t.radius * 0.2, 0, Math.PI * 2); ctx.fill();
                ctx.shadowBlur = 0;
            });

            // Arrow Rendering
            state.activeArrows.forEach(a => {
                ctx.save(); ctx.translate(a.x, a.y); ctx.rotate(a.angle);
                ctx.fillStyle = "#000"; ctx.fillRect(-20, -1.5, 45, 3);
                ctx.fillStyle = "#f44336"; ctx.beginPath(); ctx.moveTo(-15, -1); ctx.lineTo(-25, -6); ctx.lineTo(-20, -1); ctx.fill();
                ctx.beginPath(); ctx.moveTo(-15, 1); ctx.lineTo(-25, 6); ctx.lineTo(-20, 1); ctx.fill();
                ctx.restore();
            });

            requestAnimationFrame(() => { update(); draw(); });
        }

        function endGame() {
            state.gameActive = false;
            document.getElementById('overlay').style.display = 'flex';
            document.getElementById('final-score').innerText = "Final Mastery Score: " + state.score;
        }

        draw();
    </script>
</body>

</html>