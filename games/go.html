<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Strategist | GameHub Pro</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .game-wrapper {
            max-width: 900px;
            margin: 40px auto;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
        }

        .stats-bar {
            padding: 20px 40px;
            background: rgba(124, 77, 255, 0.1);
            display: flex;
            justify-content: space-around;
            font-size: 16px;
            font-weight: 800;
            border-bottom: 1px solid var(--glass-border);
        }

        .stat-val {
            color: var(--accent-secondary);
            margin-left: 5px;
        }

        .game-body {
            padding: 40px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .go-board {
            width: 500px;
            height: 500px;
            background: #dcb35c;
            /* Traditional wood color */
            border: 4px solid #8b5e34;
            display: grid;
            grid-template-columns: repeat(18, 1fr);
            grid-template-rows: repeat(18, 1fr);
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .go-cell {
            border: 0.5px solid rgba(0, 0, 0, 0.2);
            position: relative;
        }

        /* The intersections where stones are placed */
        .intersection {
            position: absolute;
            width: 24px;
            height: 24px;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
        }

        .intersection:hover:not(.stone) {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .stone {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            position: absolute;
            top: 1px;
            left: 1px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stone.black {
            background: radial-gradient(circle at 30% 30%, #444, #000);
        }

        .stone.white {
            background: radial-gradient(circle at 30% 30%, #fff, #ddd);
            border: 1px solid #ccc;
        }

        .hoshi {
            width: 6px;
            height: 6px;
            background: #000;
            border-radius: 50%;
            position: absolute;
            z-index: 5;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body class="dark-theme">
    <div class="bg-glow-container">
        <div class="glow-sphere sphere-1"></div>
        <div class="glow-sphere sphere-2"></div>
    </div>

    <header class="main-header" style="position: relative; background: transparent; border: none;">
        <div class="nav-container">
            <a href="index.html" class="logo" style="text-decoration: none; color: inherit;">
                <i data-lucide="arrow-left"></i>
                <span>BACK TO <span class="accent-text">HUB</span></span>
            </a>
            <h2 style="font-weight:800; letter-spacing:-1px">GO STRATEGIST</h2>
        </div>
    </header>

    <div class="game-wrapper">
        <div class="stats-bar">
            <span>BLACK: <span class="stat-val" id="black-score">0</span></span>
            <span>TURN: <span class="stat-val" id="turn">BLACK</span></span>
            <span>WHITE: <span class="stat-val" id="white-score">0</span></span>
        </div>

        <div class="game-body">
            <div class="go-board" id="board">
                <!-- Intersections injected by JS -->
            </div>
            <div class="game-controls" style="background: transparent; padding: 0;">
                <button class="btn-primary" onclick="pass()">PASS</button>
                <button class="btn-secondary" onclick="initGame()">RESET</button>
            </div>
            <p class="hint-text">Surround territory and capture nodes. The ancient simulator of destiny.</p>
        </div>
    </div>

    <script src="../js/shared.js"></script>
    <script>
        lucide.createIcons();

        const boardSize = 13; // 13x13 for efficiency
        const boardEl = document.getElementById('board');
        const turnEl = document.getElementById('turn');

        let board = Array(boardSize).fill().map(() => Array(boardSize).fill(null));
        let turn = 'black';
        let captures = { black: 0, white: 0 };

        function initGame() {
            boardEl.innerHTML = '';
            boardEl.style.gridTemplateColumns = `repeat(${boardSize - 1}, 1fr)`;
            boardEl.style.gridTemplateRows = `repeat(${boardSize - 1}, 1fr)`;

            // Draw grid (cells are spaces between lines)
            for (let i = 0; i < (boardSize - 1) * (boardSize - 1); i++) {
                const cell = document.createElement('div');
                cell.className = 'go-cell';
                boardEl.appendChild(cell);
            }

            // Draw intersections (where stones go)
            for (let r = 0; r < boardSize; r++) {
                for (let c = 0; c < boardSize; c++) {
                    const inter = document.createElement('div');
                    inter.className = 'intersection';
                    inter.style.top = `${(r / (boardSize - 1)) * 100}%`;
                    inter.style.left = `${(c / (boardSize - 1)) * 100}%`;
                    inter.id = `inter-${r}-${c}`;
                    inter.onclick = () => placeStone(r, c);
                    boardEl.appendChild(inter);

                    // Hoshi points
                    if (boardSize === 13 && ([3, 6, 9].includes(r) && [3, 6, 9].includes(c))) {
                        const h = document.createElement('div');
                        h.className = 'hoshi';
                        h.style.top = `${(r / (boardSize - 1)) * 100}%`;
                        h.style.left = `${(c / (boardSize - 1)) * 100}%`;
                        boardEl.appendChild(h);
                    }
                }
            }

            board = Array(boardSize).fill().map(() => Array(boardSize).fill(null));
            turn = 'black';
            captures = { black: 0, white: 0 };
            updateUI();
        }

        function placeStone(r, c) {
            if (board[r][c]) return;

            const opponent = turn === 'black' ? 'white' : 'black';
            const tempBoard = JSON.parse(JSON.stringify(board));
            tempBoard[r][c] = turn;

            // 1. Check if placement captures opponent
            let capturedAny = false;
            const neighbors = getNeighbors(r, c);
            neighbors.forEach(([nr, nc]) => {
                if (tempBoard[nr][nc] === opponent) {
                    const group = getGroup(tempBoard, nr, nc);
                    if (getLiberties(tempBoard, group) === 0) {
                        group.forEach(([gr, gc]) => {
                            board[gr][gc] = null;
                            captures[turn]++;
                        });
                        capturedAny = true;
                    }
                }
            });

            // 2. Suicide check
            board[r][c] = turn;
            const myGroup = getGroup(board, r, c);
            if (!capturedAny && getLiberties(board, myGroup) === 0) {
                board[r][c] = null; // Forbidden suicide
                alert("FORBIDDEN: Violation of Neural Balance (Suicide Move)");
                return;
            }

            render();
            if (typeof GameHubAudio !== 'undefined') GameHubAudio.play('click');
            turn = opponent;
            updateUI();
        }

        function getNeighbors(r, c) {
            return [[r - 1, c], [r + 1, c], [r, c - 1], [r, c + 1]].filter(([nr, nc]) =>
                nr >= 0 && nr < boardSize && nc >= 0 && nc < boardSize
            );
        }

        function getGroup(b, r, c) {
            const color = b[r][c];
            const group = [];
            const stack = [[r, c]];
            const visited = new Set();
            visited.add(`${r},${c}`);

            while (stack.length > 0) {
                const [currR, currC] = stack.pop();
                group.push([currR, currC]);
                getNeighbors(currR, currC).forEach(([nr, nc]) => {
                    if (b[nr][nc] === color && !visited.has(`${nr},${nc}`)) {
                        visited.add(`${nr},${nc}`);
                        stack.push([nr, nc]);
                    }
                });
            }
            return group;
        }

        function getLiberties(b, group) {
            const liberties = new Set();
            group.forEach(([r, c]) => {
                getNeighbors(r, c).forEach(([nr, nc]) => {
                    if (b[nr][nc] === null) {
                        liberties.add(`${nr},${nc}`);
                    }
                });
            });
            return liberties.size;
        }

        function pass() {
            turn = turn === 'black' ? 'white' : 'black';
            updateUI();
            if (typeof GameHubAudio !== 'undefined') GameHubAudio.play('move');
        }

        function render() {
            for (let r = 0; r < boardSize; r++) {
                for (let c = 0; c < boardSize; c++) {
                    const el = document.getElementById(`inter-${r}-${c}`);
                    const existing = el.querySelector('.stone');
                    if (board[r][c]) {
                        if (!existing) {
                            const stone = document.createElement('div');
                            stone.className = `stone ${board[r][c]}`;
                            el.appendChild(stone);
                        }
                    } else if (existing) {
                        existing.remove();
                    }
                }
            }
        }

        function updateUI() {
            turnEl.innerText = turn.toUpperCase();
            turnEl.style.color = turn === 'black' ? '#fff' : 'var(--accent-secondary)';
            document.getElementById('black-score').innerText = captures.white;
            document.getElementById('white-score').innerText = captures.black;
        }

        initGame();
    </script>
</body>

</html>